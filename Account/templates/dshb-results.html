{% extends 'base2.html' %}
{% load static %}
{% block content %}

  <div class="dashboard__main">
    <div class="dashboard__content bg-light-4">

      {% include 'messages.html' %}
      <div class="row pb-10 mb-10">
        <div class="col-auto">
  
          {% comment %} <h1 class="text-30 lh-12 fw-700">İmtahan Qaydaları - <i>{{ student.get_full_name|capfirst }}</i></h1> {% endcomment %}
          <h1 class="text-30 lh-12 fw-700">Nəticələr</h1>
  
        </div>
      </div>
      <div class="row y-gap-30">
        <div class="col-12">
          <div class="rounded-16 bg-white -dark-bg-dark-1 shadow-4 h-100">
            <div class="tabs -active-purple-2 js-tabs pt-0">
              <div class="tabs__content py-30 px-30 js-tabs-content">

                <div class="tabs__pane -tab-item-1 is-active" data-pane="tab1">
                  <div class="row y-gap-10 ">
                    <div class="col-auto">
                      <form class="search-field border-light rounded-8 h-50" action="." method="get">
                        <select class="js-example-basic-single" name="state" onchange="this.form.submit()" style="min-width: 200px;">
                          <option value="0" {% if request.GET.state == 0 %}selected{% endif %}>------</option>
                          {% for group in groups %}
                            <option value="{{ group.id }}" {% if group.id|stringformat:"s" == request.GET.state %}selected{% endif %}>{{ group.name|capfirst }}</option>
                          {% endfor %}
                        </select>
                      </form>
                    </div>
                  </div>

                  <style>
                    .tDiv{
                      width:100%;
                      overflow-x:scroll;
                    }
                  </style>

                  <div class="tDiv py-30">
                    <div class="table-responsive">
                      <table class="table">
                        <thead>
                          <tr>
                            <th>№</th>
                            <th>Ad Soyad</th>
                            <th>Nəticə</th>
                            <th>Ortalama</th>
                            {% for topic in topics.all_course_topics.all %}
                              <th></th>
                              {% comment %} <th>{{ topic.topic_title|capfirst }}</th> {% endcomment %}
                            {% endfor %}
                          </tr>
                        </thead>
                        <tbody>

                          {% for result in group_results %}
                            <tr>
                              <td class="tc">{{ forloop.counter }}</td>
                              <td class="tc">{{ result.student.get_full_name|capfirst }}</td>
                              <td class="tc">{{ result.true_percent_point }} %</td>

                              <td class="tc">
                                {% for st in average_total_point %}
                                  {% if result.student.id == st.student %}
                                    {{ st.average_total_point|floatformat:2 }} %
                                  {% endif %}
                                {% endfor %}
                              </td>

                              {% for old_result in old_group_result %}
                                {% if result.student == old_result.student %}
                                  <td class="tc"><i>{{ old_result.exam_topics }}</i> / {{ old_result.percent_point }} %</td>
                                {% endif %}
                              {% endfor %}

                            </tr>
                          {% endfor %}

                        </tbody>
                      </table>
                    </div>
                  </div>

                </div>

              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.1.0-rc.0/js/select2.min.js"></script>
  <script>
    $(document).ready(function () {
      $('.js-example-basic-single').select2();
    })
  </script>


<!-- Add this before your closing </body> tag -->
<script>
  $(document).ready(function () {
      function reloadPage() {
          location.reload(true); // Force a reload from the server
      }

      // Set the page reload interval (e.g., every 5 seconds)
      setInterval(reloadPage, 15000);
  });
</script>

  {% endblock %}
